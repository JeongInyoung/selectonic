/*! Selectonic - v0.3.1 - 2014-01-02
* https://github.com/anovi/selectonic
* Copyright (c) 2014 Alexey Novichkov; Licensed MIT */
!function(a,b,c){"use strict";function d(b,c){this._name=d.pluginName,this.el=b,this.$el=a(b),this.ui={},this._selected=0,this._isEnable=!0,this._keyModes={},this.options={};var e=a.extend({},d.defaults,c||{});this._setOptions(e),this._init()}"undefined"==typeof Array.prototype.indexOf&&(Array.prototype.indexOf=function(a,b){if(!this)throw new TypeError;b=isNaN(b=+b)?0:b;var c=this.length;if(0===c||b>=c)return-1;for(0>b&&(b+=c);c>b;){if(this[b]===a)return b;++b}return-1});var e=function(a,b,c){var d,e,f,g=null,h=0;c=c||{};var i=function(){h=c.leading===!1?0:new Date,g=null,f=a.apply(d,e)};return function(){var j=new Date;h||c.leading!==!1||(h=j);var k=b-(j-h);return d=this,e=arguments,0>=k?(clearTimeout(g),g=null,h=j,f=a.apply(d,e)):g||c.trailing===!1||(g=setTimeout(i,k)),f}},f=a(b.document);d.pluginName="selectonic",d.keyCode={DOWN:40,UP:38,SHIFT:16,END:35,HOME:36,PAGE_DOWN:34,PAGE_UP:33,A:65,SPACE:32,ENTER:13},d.optionsEvents=["create","before","focusLost","select","unselect","unselectAll","stop","destroy"],d.optionsStrings=["filter","mouseMode","event","keyboardMode","listClass","focusClass","selectedClass","disabledClass","handle"],d.defaults={filter:"> *",multi:!0,mouseMode:["select","toggle"],event:["mousedown","click","hybrid"],focusBlur:!1,selectionBlur:!1,handle:null,textSelection:!1,hoverFocus:!1,keyboard:!1,keyboardMode:["select","toggle"],autoScroll:!0,loop:!1,preventInputs:!0,listClass:"j-selectable",focusClass:"j-focused",selectedClass:"j-selected",disabledClass:"j-disabled",create:null,before:null,focusLost:null,select:null,unselect:null,unselectAll:null,stop:null,destroy:null},d.getDataObject=function(b){return a(b).data("plugin_"+d.pluginName)},d.prototype._init=function(){this.$el.addClass(this.options.listClass),this._bindEvents(),this.$el.data("plugin_"+d.pluginName,this),this._callEvent("create")},d.prototype._setOptions=function(){var b,c,e,f={},g=this;if(2===arguments.length)f[arguments[0]]=arguments[1];else{if(!a.isPlainObject(f))throw new Error('Format of "option" could be: "option" or "option","name" or "option","name",val or "option",{}');f=arguments[0]}a.each(d.optionsStrings,function(c,e){if(b=f[e]){var h=["mouseMode","event","keyboardMode"].indexOf(e);if(a.isArray(b)&&h>=0&&b===d.defaults[e])f[e]=b[0];else if(h>=0){var i=d.defaults[e];if(i.indexOf(a.trim(String(b)))<0)throw new RangeError('Option "'+e+'" only could be in these values: "'+i.join('", "')+'".')}else f[e]=a.trim(String(b));if(g.options.parentSelector&&("listClass"===e||"focusClass"===e||"selectedClass"===e||"disabledClass"===e))throw new Error("Sorry, it's not allowed to dynamically change classnames!")}}),a.each(d.optionsEvents,function(c,d){if(b=f[d],void 0!==b&&(e=a.isFunction(b),!e&&null!==b))throw new TypeError('Option "'+d+'" should be a function or "null"!')}),c=a.extend({},this.options,f),c.parentSelector="."+c.listClass+" "+c.filter,void 0!==f.autoScroll&&this._setScrolledElem(f.autoScroll),this.options=c},d.prototype._destroy=function(){this._callEvent("destroy"),this._unbindEvents(),this._focusHoverTimeout&&clearTimeout(this._focusHoverTimeout),this.ui.focus&&(a(this.ui.focus).removeClass(this.options.focusClass),delete this.ui.focus),this._selected>0&&this.getSelected().removeClass(this.options.selectedClass),this.$el.removeClass(this.options.disabledClass),this.$el.removeClass(this.options.listClass),delete this._scrolledElem,delete this._solidInitialElem},d.prototype._setScrolledElem=function(b){var c;if(null===b||!1===b)return delete this._scrolledElem,void 0;if("string"==typeof b){if(c=a(b),!(c.length>0))throw new Error('There are no elements that matches to selector - "'+b+'"');return this._scrolledElem=c[0],void 0}this._scrolledElem=this.el},d.prototype._cancel=function(b,c){c.wasCancelled||(c.isCancellation=this._isPrevented=!0,a.each(a(c.changedItems),a.proxy(function(d,e){c.prevItemsState[d]?this._select(b,c,a(e),!0):this._unselect(b,c,a(e),!0)},this)),c.prevFocus&&this._setFocus(c.prevFocus),delete c.isCancellation,c.wasCancelled=!0)},d.prototype._bindEvents=function(){var a=this;this._mouseEvent=function(b){return a._isEnable&&a._mouseHandler.call(a,b),b},this._keyboardEvent=function(b){a.options.keyboard&&a._isEnable&&a._keyHandler.call(a,b)},this._selectstartEvent=function(){return a.options.textSelection?void 0:!1},this._mousemoveEvent=e(function(b){a._isEnable&&a.options.hoverFocus&&a._mousemoveHandler.call(a,b)},20),f.on("click."+this._name+" mousedown."+this._name,this._mouseEvent),f.on("keydown."+this._name+" keyup."+this._name,this._keyboardEvent),this.$el.on("selectstart."+this._name,this._selectstartEvent),f.on("mousemove."+this._name,this._mousemoveEvent)},d.prototype._unbindEvents=function(){f.off("click."+this._name+" mousedown."+this._name,this._mouseEvent),f.off("keydown."+this._name+" keyup."+this._name,this._keyboardEvent),this.$el.off("selectstart."+this._name,this._selectstartEvent),f.off("mousemove."+this._name,this._mousemoveEvent)},d.prototype._getTarget=function(c){for(var d,e,f,g=c.target,h=this.options.handle;null!==g&&g!==this.el;)d=a(g),d.context=b.document,d.is(this.options.parentSelector)&&(e=g),h&&d.is(h)&&(f=g),g=g.parentNode;return h&&g&&f?e:!h&&g?e:null},d.prototype._getSelected=function(b){var c,d,e;return b?(c=[],e=this.$el.children("."+this.options.selectedClass),a.each(e,function(b,d){c.push(a(d).attr("id")||null)}),d=c.length>0?c:null):d=this.$el.children("."+this.options.selectedClass),d},d.prototype._getItems=function(c,d,e){var f;switch(d){case"next":case"prev":for(var g=e.jquery?e:a(e),h=a.fn[d];;){if(g=h.call(g),0===g.length)break;if(g.context=b.document,g.is(this.options.parentSelector))return g}return null;case"pageup":case"pagedown":for(var i,j,k=this._scrolledElem||this.el,l=k.clientHeight,m=a(b).outerHeight(),n=a(e),o=l>m,p=o?m:l,q=n.outerHeight(),r=q,s=q,t="pageup"===d?"prev":"next";;){if(i=this._getItems(c,t,n),!i&&n.is(e))break;if(!i)return n;if(j=i.outerHeight(),s+=j,s>p)return r+j>p?i:n;r=j,n=i}return null;case"first":return f=c.allItems?c.allItems:this.$el.find(this.options.filter),c.allItems=f,f.first();case"last":return f=c.allItems?c.allItems:this.$el.find(this.options.filter),c.allItems=f,f.last();default:return f=c.allItems?c.allItems:this.$el.find(this.options.filter),c.allItems=f,f}},d.prototype._callEvent=function(a,b,c){var d,e=this.options[a];if(e){if("create"===a||"destroy"===a)return e.call(this.$el);switch(d={},c.target&&(d.target=c.target),this.ui.focus&&(d.focus=this.ui.focus),a){case"select":d.items=c.selected;break;case"unselectAll":case"unselect":d.items=c.unselected;break;case"stop":c.wasCancelled||(d.items=c.changedItems)}e.call(this.$el,b||null,d)}},d.prototype._controller=function(a,b){var d;return b.changedItems=[],b.prevItemsState=[],delete this._isPrevented,this._callEvent("before",a,b),this._isPrevented?(this._cancel(a,b),this._stop(a,b),void 0):(b.wasSelected=this._selected>0,b.target&&b.isTargetWasSelected===c&&(b.isTargetWasSelected=this._getIsSelected(b.target)),b.isRangeSelect&&b.isTargetWasSelected&&b.target===this.ui.focus||(b.isRangeSelect?this._perfomRangeSelect(a,b):b.isMultiSelect?(d=b.isTargetWasSelected?this._unselect:this._select,d.call(this,a,b,b.items)):b.target&&!b.items&&"mouseover"===a.type||(b.target&&b.items?(this._selected&&1===this._selected&&this._getIsSelected(this.ui.focus)?this._unselect(a,b,this.ui.focus,b.isTargetWasSelected):this._selected&&this._unselectAll(a,b),this._select(a,b,b.items,b.isTargetWasSelected)):!b.target&&this._selected>0&&this.options.selectionBlur&&this._unselectAll(a,b))),!this._selected&&b.wasSelected&&this._callEvent("unselectAll",a,b),b.prevFocus=this.ui.focus?this.ui.focus:null,!b.target&&this.options.focusBlur?this._blur(a,b):b.target&&!b.wasCancelled&&this._setFocus(b.target),this._stop(a,b),void 0)},d.prototype._perfomRangeSelect=function(a,b){var c,d,e,f,g,h,i,j=b.rangeStart<b.rangeEnd,k=this._getItems(b),l=j?b.rangeStart:b.rangeEnd,m=j?b.rangeEnd:b.rangeStart;b.isNewSolidSelection?(d=k.slice(0,l),d=d.add(k.slice(m+1)),this._unselect(a,b,d),this._select(a,b,b.items)):this._solidInitialElem&&!b.isTargetWasSelected&&(e=b.items.index(this._solidInitialElem))>=0?(e=j?b.rangeStart+e:b.rangeEnd+e,f=e<b.rangeStart,g=b.rangeStart<e,h=e<b.rangeEnd,i=b.rangeEnd<e,(!h&&f||!i&&g)&&(d=g?k.slice(l,e):k.slice(e+1,m+1),d.length>0&&this._unselect(a,b,d)),(i&&!g||h&&!f)&&(d=i?k.slice(l,e):k.slice(e+1,m+1),d.length>0&&this._select(a,b,d))):(c=b.isTargetWasSelected?this._unselect:this._select,c.call(this,a,b,b.items))},d.prototype._changeItemsStates=function(b,c,d){var e=c>0,f=[],g=this;a(b).each(function(b,h){var i=g._getIsSelected(h),j=e?!i:i,k=h===d.target&&d.isTargetWasSelected;(!k||e||d.isMultiSelect||d.isRangeSelect)&&(j&&(d.isCancellation||(f.push(h),d.prevItemsState.push(i)),g._selected+=c),a(h).toggleClass(g.options.selectedClass,e))}),d.isCancellation||(d[e?"selected":"unselected"]=a(f),d.changedItems=d.changedItems.concat(f))},d.prototype._select=function(a,b,c,d){this._changeItemsStates(c,1,b),d||this._callEvent("select",a,b),this._isPrevented&&!b.isCancellation&&this._cancel(a,b)},d.prototype._unselect=function(a,b,c,d){this._changeItemsStates(c,-1,b),d||this._callEvent("unselect",a,b),this._isPrevented&&!b.isCancellation&&this._cancel(a,b)},d.prototype._unselectAll=function(a,b){var c,d;this._selected&&0!==this._selected&&(d=this._getItems(b),c=b.target&&b.isTargetWasSelected&&1===this._selected,this._unselect(a,b,d,c))},d.prototype._multiSelect=function(b){return b.isMultiSelect=!0,a(b.target)},d.prototype._rangeSelect=function(b){if(b.isRangeSelect=!0,b.target===this.ui.focus)return a(b.target);var c=this._getItems(b),d=c.index(b.target),e=c.index(this.ui.focus),f=e>d?c.slice(d,e):c.slice(e,d);return f.push(e>d?c[e]:c[d]),b.rangeStart=e,b.rangeEnd=d,f},d.prototype._getIsSelected=function(b){var c=this.options;return a(b).length<=1?a(b).hasClass(c.selectedClass):a.map(a(b),function(b){return a(b).hasClass(c.selectedClass)})},d.prototype._blur=function(b,c,d){!d&&this.ui.focus&&this._callEvent("focusLost",b,c),this.ui.focus&&(a(this.ui.focus).removeClass(this.options.focusClass),delete this.ui.focus)},d.prototype._setFocus=function(b){return b?(this.ui.focus&&a(this.ui.focus).removeClass(this.options.focusClass),this.ui.focus=b,a(this.ui.focus).addClass(this.options.focusClass),this.ui.focus):void 0},d.prototype._stop=function(a,b){this._callEvent("stop",a,b),this._isPrevented&&this._cancel(a,b)},d.prototype._keyHandler=function(b){if(this.options.keyboard&&!(this.options.preventInputs&&"INPUT"===b.target.tagName||"TEXTAREA"===b.target.tagName)){var c,e,f,g=b.which,h={};if("keyup"===b.type)return g===d.keyCode.SHIFT&&(delete this._shiftModeAction,delete this._keyModes.shift),void 0;if(g===d.keyCode.A&&(b.metaKey||b.ctrlKey)&&this.options.multi)c=this._getItems(h),e=!0;else switch(g){case d.keyCode.HOME:f="prev",c=this._getItems(h,"first");break;case d.keyCode.END:f="next",c=this._getItems(h,"last");break;case d.keyCode.DOWN:f="next",c=this._findNextTarget("next",h);break;case d.keyCode.UP:f="prev",c=this._findNextTarget("prev",h);break;case d.keyCode.PAGE_DOWN:f="next",c=this._findNextTarget("pagedown",h);break;case d.keyCode.PAGE_UP:f="prev",c=this._findNextTarget("pageup",h);break;case d.keyCode.SPACE:c=a(this.ui.focus);break;case d.keyCode.ENTER:this.options.multi||(c=a(this.ui.focus))}return c&&c.length>0&&(b.preventDefault(),h.target=c[0],h.items=c,"toggle"===this.options.keyboardMode?(g===d.keyCode.SPACE||g===d.keyCode.ENTER&&!this.options.multi||delete h.items,this.options.multi&&(h.isMultiSelect=!0),delete this._solidInitialElem):this.ui.focus&&this.options.multi&&b.shiftKey&&!e?(g===d.keyCode.END||g===d.keyCode.HOME||g===d.keyCode.PAGE_UP||g===d.keyCode.PAGE_DOWN?this._rangeVariator(h):this._multiVariator(h,g,f,c),this._solidInitialElem||h.target===this.ui.focus||(this._solidInitialElem=this.ui.focus,h.isNewSolidSelection=!0),this._shiftModeAction||(this._shiftModeAction="select"),this._keyModes.shift||(this._keyModes.shift=g)):delete this._solidInitialElem,this._controller(b,h),this.scroll()),b}},d.prototype._rangeVariator=function(a){var b=this._getIsSelected(this.ui.focus),c=a.isTargetWasSelected=this._getIsSelected(a.target);b||c?(a.items=this._rangeSelect(a),c&&(a.items=a.rangeStart<a.rangeEnd?a.items.slice(0,a.items.length-1):a.items.slice(1))):(a.target=a.items=this.ui.focus,a.isMultiSelect=!0)},d.prototype._multiVariator=function(a,b,c,d){var e,f=this._getIsSelected(this.ui.focus),g=this._getIsSelected(a.target),h=this._getItems(a,c,d),i=this._getIsSelected(h);if(this._keyModes.shift&&this._keyModes.shift!==b&&(this._keyModes.shift=this._shiftModeAction=null),this._keyModes.shift&&"select"===this._shiftModeAction&&g){for(;this._getIsSelected(a.items)&&a.items.length>0;)e=a.items,a.items=this._getItems(a,c,a.items);a.target=a.items?a.items:e}else g&&f&&!i?(this._keyModes.shift=this._shiftModeAction=null,a.items=this.ui.focus):f&&g?(a.items=this.ui.focus,this._shiftModeAction||(this._shiftModeAction="unselect")):f||(a.target=a.items=this.ui.focus);a.isMultiSelect=!0},d.prototype._findNextTarget=function(a,b){var c="next"===a||"pagedown"===a?"first":"last",d=this.ui.focus?this._getItems(b,a,this.ui.focus):this._getItems(b,c);return null!==d&&0!==d.length||!this.options.loop||(d=this._getItems(b,c)),d},d.prototype._refreshBoxScroll=function(c){var d=a(c),e=c===b,f=e?d.outerHeight():c.clientHeight,g=d.scrollTop(),h=e?0:d.offset().top,i=a(this.ui.focus),j=i.outerHeight(),k=e?i.offset().top:i.offset().top-h+g;g>k?d.scrollTop(k):k+j>g+f&&d.scrollTop(k+j-f)},d.prototype._mouseHandler=function(b){var c=this.options,d={};if("hybrid"===c.event){if("click"===b.type&&!this._mouseDownMode)return;if(d.target=this._getTarget(b),d.target&&"mousedown"===b.type&&(d.isTargetWasSelected=this._getIsSelected(d.target),d.isTargetWasSelected))return this._mouseDownMode=!0,void 0;this._mouseDownMode&&delete this._mouseDownMode}else{if(b.type!==c.event)return;d.target=this._getTarget(b)}c.multi&&d.target&&((b.shiftKey||b.shiftKey&&b.ctrlKey)&&this.ui.focus?d.items=this._rangeSelect(d):(b.ctrlKey||b.metaKey||"toggle"===c.mouseMode)&&(d.items=this._multiSelect(d))),d.target&&!d.items&&(d.items=a(d.target)),delete this._solidInitialElem,this._controller(b,d)},d.prototype._mousemoveHandler=function(a){if(!this._isHoverFocusPrevented){var b,c={};b=this._getTarget(a),b?(delete this._solidInitialElem,b!==this.ui.focus&&(c.target=b,this._controller(a,c))):this._controller(a,c)}},d.prototype._preventMouseMove=function(){var a=this;this._isHoverFocusPrevented=!0,this._focusHoverTimeout&&(clearTimeout(this._focusHoverTimeout),delete this._focusHoverTimeout),this._focusHoverTimeout=setTimeout(function(){delete a._isHoverFocusPrevented,delete a._focusHoverTimeout},250)},d._callPublicMethod=function(b){var c,e,f=d.getDataObject(this);if(null===f||void 0===f)throw new Error("Element "+this[0]+" has no plugin "+d.pluginName);if(f[b]&&a.isFunction(f[b])&&(c=f[b]),c&&a.isFunction(c)&&"_"!==b.charAt(0))return e=Array.prototype.slice.call(arguments),e.shift(),c.apply(f,e);throw new Error('Plugin "'+d.pluginName+'" has no method "'+b+'"')},d.prototype.isEnabled=function(){return this._isEnable},d.prototype.option=function(b,c){var d=arguments.length;if(d>0&&"string"==typeof b)return d>1?(this._setOptions(b,c),this.$el):this.options[b];if(d>0&&a.isPlainObject(b))return this._setOptions(b),this.$el;if(0===d)return a.extend({},this.options);throw new Error('Format of "option" could be: "option" or "option","name" or "option","name",val or "option",{}')},d.prototype.destroy=function(){this._destroy(),this.$el.removeData("plugin_"+d.pluginName),this.$el=null},d.prototype.select=function(b){var c,d={};if(b&&(b.jquery||b.nodeType))b=b.jquery?b:a(b),c=b.filter(this.options.parentSelector),c=c.length>0?c:null;else{if("string"!=typeof b)throw new Error('You shold pass DOM element or selector to "select" method.');c=this.$el.find(b).filter(this.options.parentSelector),c=c.jquery&&c.length>0?c:null}return c&&(d.items=c.addClass?c:a(c),d.target=c[0]||c,delete this._solidInitialElem,this._controller(null,d)),this.$el},d.prototype.blur=function(){var a={};return a.target=null,this._controller(null,a),this.$el},d.prototype.getSelected=function(){return this._getSelected()},d.prototype.getSelectedId=function(){return this._getSelected(!0)},d.prototype.getFocused=function(){return this.ui.focus?this.ui.focus:null},d.prototype.scroll=function(){this._preventMouseMove(),this.ui.focus&&(this._scrolledElem&&this._refreshBoxScroll(this._scrolledElem),this._refreshBoxScroll(b))},d.prototype.enable=function(){return this._isEnable=!0,this.$el.removeClass(this.options.disabledClass),this.$el},d.prototype.disable=function(){return this._isEnable=!1,this.$el.addClass(this.options.disabledClass),this.$el},d.prototype.cancel=function(){return this._isPrevented=!0,this.$el},d.prototype.refresh=function(){var b=this.ui.focus;return b&&!a(b).is(":visible")&&delete this.ui.focus,this._selected=this.getSelected().length,this.$el},a.fn[d.pluginName]=function(a){return a&&a.charAt?d._callPublicMethod.apply(this,arguments):this.each(function(b,c){d.getDataObject(c)||new d(c,a)})}}(jQuery,window);