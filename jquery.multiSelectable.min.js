/*! jquery-multiSelectable - v0.1.0 - 2013-12-17 */!function(a,b,c){"use strict";function d(b,c){this._name=e,this.options=d.setInitOptions(c),this.el=b,this.$el=a(b),this.ui={},this._selected=0,this._changedItems=[],this._prevItemsState=[],this._isEnable=!0,this._keyModes={},this.options.parentSelector="."+this.options.wrapperClass+" "+this.options.filter,this._init()}var e="multiSelectable",f=b.document,g={filter:"> *",mouseMode:"select",event:"mousedown",scrolledElem:!0,multi:!0,focusBlur:!1,selectionBlur:!1,keyboardInput:!1,preventInputs:!0,loop:!1,handle:null,wrapperClass:"j-"+e,focusClass:"j-"+e+"-focused",selectedClass:"j-"+e+"-selected",disabledClass:"j-"+e+"-disabled",create:function(){},beforeSelect:function(){},focusLost:function(){},select:function(){},unSelect:function(){},unSelectAll:function(){},stop:function(){},destroy:function(){}},h={DOWN:40,UP:38,SHIFT:16,END:35,HOME:36,PAGE_DOWN:34,PAGE_UP:33,A:65};d.setDataObject=function(b,c){return a(b).data("plugin_"+e,c)},d.getDataObject=function(b){return a(b).data("plugin_"+e)},d.setInitOptions=function(b){var c;return b&&a.each(["item","wrapperClass","focusClass","selectedClass","handle"],function(d,e){c=b[e],null!==c&&void 0!==c&&(c=a.trim(String(c)))}),a.extend({},g,b||{})},d.command=function(b){var c,f,g=d.getDataObject(this);if(null===g||void 0===g)throw new Error("Element "+this[0]+" has no plugin "+e);if(g[b]&&a.isFunction(g[b])&&(c=g[b]),c&&a.isFunction(c)&&"_"!==b.charAt(0))return c.apply(g,arguments);if(b&&b.addClass||b.nodeType)return g.select(a(b).filter(g.options.parentSelector));if(f=this.find(b).filter(g.options.parentSelector),f&&f.length&&f.length>0)return g.select(f);throw new Error("Plugin "+e+" has no method '"+b+"'")},d.prototype.isEnabled=function(){return this._isEnable},d.prototype.option=function(){var b=arguments[1],c=arguments.length;return c>1&&b.charAt?c>2?(this.options[b]=arguments[2],void 0):this.options[b]:c>1&&a.isPlainObject(b)?(a.extend(this.options,b),void 0):this.options},d.prototype.destroy=function(){this._destroy(),this.$el.removeData("plugin_"+e),this.$el=null},d.prototype.select=function(b){this._items=b.addClass?b:a(b),this.ui.target=b[0]||b,this._controller(null)},d.prototype.blur=function(){this.ui.target=null,this._controller(null)},d.prototype.getSelected=function(){return this._getSelected()},d.prototype.getFocused=function(){return this.ui.focus?this.ui.focus:null},d.prototype.getSelectedId=function(){return this._getSelected(!0)},d.prototype.enable=function(){this._isEnable=!0,this.$el.removeClass(this.options.disabledClass)},d.prototype.disable=function(){this._isEnable=!1,this.$el.addClass(this.options.disabledClass)},d.prototype.cancel=function(){this._prevent()},d.prototype.refresh=function(){var b=this.ui.focus;b&&!a(b).is(":visible")&&delete this.ui.focus,this._selected=this.getSelected().length},d.prototype._init=function(){this.$el.addClass(this.options.wrapperClass),this._setScrolledElem(this.options.scrolledElem),this._onHandler(),d.setDataObject(this.$el,this),this.options.create.call(this.$el)},d.prototype._destroy=function(){this.options.destroy.call(this.$el),this._offHandler(),this.ui.focus&&(a(this.ui.focus).removeClass(this.options.focusClass),delete this.ui.focus),this._selected>0&&this.getSelected().removeClass(this.options.selectedClass),this.$el.removeClass(this.options.disabledClass),this.$el.removeClass(this.options.wrapperClass),this._scrolledElem&&delete this._scrolledElem},d.prototype._setScrolledElem=function(b){var c;if(null!==b&&!1!==b)return"string"==typeof b?(c=a(b),c.length>0&&(this._scrolledElem=c[0]),void 0):(this._scrolledElem=this.el,void 0)},d.prototype._prevent=function(){this._isPrevented=!0},d.prototype._cancel=function(b){this._isCancellation=!0,a.each(a(this._changedItems),a.proxy(function(c,d){this._prevItemsState[c]?this._select(b,a(d),!0):this._unselect(b,a(d),!0)},this)),delete this._isCancellation,delete this._isPrevented},d.prototype._onHandler=function(){var b;b="click"===this.options.event?"click":"mousedown",this._mouseEventHandler=a.proxy(function(a){return this._isEnable&&this._mouseHandler(a),a},this),this._keyEventHandler=a.proxy(function(a){return this.options.keyboardInput&&this._isEnable&&this._keyHandler(a),a},this),a(f).on("click."+this._name+" mousedown."+this._name,this._mouseEventHandler),a(f).on("keydown."+this._name+" keyup."+this._name,this._keyEventHandler)},d.prototype._offHandler=function(){var b="click"===this.options.event?"click":"mousedown";a(f).off(b+"."+this._name,this._mouseEventHandler),a(f).off("keydown."+this._name+" keyup."+this._name,this._keyEventHandler)},d.prototype._keyHandler=function(a){if(this.options.keyboardInput&&!(this.options.preventInputs&&"INPUT"===a.target.tagName||"TEXTAREA"===a.target.tagName)){var c,d,e,f=a.which;if("keyup"===a.type)return f===h.SHIFT&&(delete this._shiftModeAction,delete this._keyModes.shift),void 0;if(f===h.A&&(a.metaKey||a.ctrlKey)&&this.options.multi)a.preventDefault(),c=this._getItems(),d=!0;else switch(f){case h.HOME:e="prev",c=this._getItems("first");break;case h.END:e="next",c=this._getItems("last");break;case h.DOWN:e="next",c=this._findNextSibling("next");break;case h.UP:e="prev",c=this._findNextSibling("prev")}if(c&&c.length>0){if(a.preventDefault(),this.ui.target=c[0],this._items=c,this.ui.focus&&this.options.multi&&a.shiftKey&&!d){var g=this._getIsSelected(this.ui.focus),i=this._getIsSelected(this.ui.target),j=this._getItems(e,c),k=this._getIsSelected(j);if(this._keyModes.shift&&this._keyModes.shift!==f&&(this._keyModes.shift=null,this._shiftModeAction=null),!g&&i&&this._selected>1);else if(this._keyModes.shift&&"select"===this._shiftModeAction&&i){for(;this._getIsSelected(this._items)&&this._items.length>0;)this._items=this._getItems(e,this._items);this._items.length>0&&(this.ui.target=this._items)}else i&&g&&!k?(this._keyModes.shift=null,this._shiftModeAction=null,this._items=this.ui.focus):g&&i?(this._items=this.ui.focus,this._shiftModeAction||(this._shiftModeAction="unselect")):!g&&i?(this._items=this.ui.focus,this._isTargetWasSelected=!1):g||i||(this.ui.target=this.ui.focus,this._items=this.ui.focus);this._shiftModeAction||(this._shiftModeAction="select"),this._keyModes.shift||(this._keyModes.shift=f),f===h.END||f===h.HOME?this._items=this._rangeSelect():this._isMultiSelect=!0}this._controller(a),this.ui.focus&&(this._scrolledElem&&this._recalcElemScroll(this._scrolledElem),this._recalcElemScroll(b))}return a}},d.prototype._findNextSibling=function(a){var b="next"===a?"first":"last",c=this.ui.focus?this._getItems(a,this.ui.focus):this._getItems(b);return 0===c.length&&this.options.loop&&(c=this._getItems(b)),c},d.prototype._recalcElemScroll=function(c){var d,e=c===b?null:a(c).css("position"),f=a(this.ui.focus).outerHeight(),g=a(c).scrollTop(),h=c===b?a(c).outerHeight():c.clientHeight;c!==b&&"fixed"!==e&&"absolute"!==e&&"relative"!==e?(a(c).css("position","relative"),d=a(this.ui.focus).position().top+g,a(c).css("position",e)):d=c===b?a(this.ui.focus).offset().top:a(this.ui.focus).position().top+g,g>d?a(c).scrollTop(d):d+f>g+h&&a(c).scrollTop(d+f-h)},d.prototype._getTarrget=function(b){for(var c,d=b.target,e=this.options.handle;null!==d&&d!==this.el;)a(d).is(this.options.parentSelector)&&(c=d),e&&a(d).is(e)&&(this.ui.handle=d),d=d.parentNode;return e&&d&&this.ui.handle?c:!e&&d?c:null},d.prototype._getSelected=function(b){return b?a.map(this.$el.children("."+this.options.selectedClass),function(b){return a(b).attr("id")}):this.$el.children("."+this.options.selectedClass)},d.prototype._getSelectedId=function(){return this._getSelected(!0)},d.prototype._getItems=function(b,c){switch(b){case"next":return a(c).next(this.options.parentSelector);case"prev":return a(c).prev(this.options.parentSelector);case"first":return this.$el.find(this.options.filter).first();case"last":return this.$el.find(this.options.filter).last();default:return this.$el.find(this.options.filter)}},d.prototype._mouseHandler=function(b){var c=this.options;if("hybrid"===c.event){if("click"===b.type&&!this._mouseDownMode)return;if(this.ui.target=this._getTarrget(b),this.ui.target&&"mousedown"===b.type&&(this._isTargetWasSelected=this._getIsSelected(this.ui.target),this._isTargetWasSelected))return this._mouseDownMode=!0,void 0;this._mouseDownMode&&delete this._mouseDownMode}else{if(b.type!==c.event)return;this.ui.target=this._getTarrget(b)}c.multi&&this.ui.target&&((b.shiftKey||b.shiftKey&&b.ctrlKey)&&this.ui.focus?this._items=this._rangeSelect():(b.ctrlKey||b.metaKey||"toggle"===c.mouseMode)&&(this._items=this._multiSelect())),this.ui.target&&!this._items&&(this._items=a(this.ui.target)),this._controller(b)},d.prototype._controller=function(a){return this.options.beforeSelect.call(this.$el,a,this.ui),this._isPrevented?(this._cancel(a),this._stop(a),void 0):(this._prevFocus=this.ui.focus?this.ui.focus:null,this._isWasSelected=this._selected>0,this.ui.target&&this._isTargetWasSelected===c&&(this._isTargetWasSelected=this._getIsSelected(this.ui.target)),this._isRangeSelect&&this._isTargetWasSelected&&this.ui.target===this.ui.focus||(this._isRangeSelect||this._isMultiSelect?this._isTargetWasSelected?this._unselect(a,this._items):this._select(a,this._items):this.ui.target?(this._selected&&(1===this._selected&&this._getIsSelected(this.ui.focus)?this._unselect(a,this.ui.focus,this._isTargetWasSelected):this._unselectAll(a)),this._select(a,this._items,this._isTargetWasSelected)):(this.options.focusBlur&&this._blur(a),this._selected>0&&this.options.selectionBlur&&this._unselectAll(a))),this._setFocus(this.ui.target),this._stop(a),void 0)},d.prototype._forEachItem=function(b,c){var d=c>0,e=[],f=this;a(b).each(function(b,g){var h=f._getIsSelected(g),i=d?!h:h,j=g===f.ui.target&&f._isTargetWasSelected;(!j||d||f._isMultiSelect||f._isRangeSelect)&&(i&&(f._isCancellation||(e.push(g),f._prevItemsState.push(h)),f._selected+=c),a(g).toggleClass(f.options.selectedClass,d))}),this._isCancellation||(this.ui.items=a(e),this._changedItems=this._changedItems.concat(e))},d.prototype._select=function(a,b,c){this._forEachItem(b,1),c||this.options.select.call(this.$el,a,this.ui),this._isPrevented&&!this._isCancellation&&this._cancel(a)},d.prototype._unselect=function(a,b,c){this._forEachItem(b,-1),c||this.options.unSelect.call(this.$el,a,this.ui),this._isPrevented&&!this._isCancellation&&this._cancel(a)},d.prototype._unselectAll=function(a){var b,c;this._selected&&0!==this._selected&&(c=this._getItems(),b=this.ui.target&&this._isTargetWasSelected&&1===this._selected,this.ui.items=null,this._unselect(a,c,b))},d.prototype._multiSelect=function(){return this._isMultiSelect=!0,a(this.ui.target)},d.prototype._rangeSelect=function(){if(this._isRangeSelect=!0,this.ui.target===this.ui.focus)return a(this.ui.target);var b=this._getItems(),c=b.index(this.ui.target),d=b.index(this.ui.focus),e=d>c?b.slice(c,d):b.slice(d,c);return e.push(d>c?b[d]:b[c]),e},d.prototype._getIsSelected=function(b){if(a(b).length<=1)return a(b).hasClass(this.options.selectedClass);var c=this.options;return a.map(a(b),function(b){return a(b).hasClass(c.selectedClass)})},d.prototype._blur=function(b,c){!c&&this.ui.focus&&this.options.focusLost.call(this.$el,b,this.ui),this.ui.focus&&(a(this.ui.focus).removeClass(this.options.focusClass),delete this.ui.focus)},d.prototype._setFocus=function(b){return b?(this.ui.focus&&a(this.ui.focus).removeClass(this.options.focusClass),this.ui.focus=b,a(this.ui.focus).addClass(this.options.focusClass),this.ui.focus):void 0},d.prototype._stop=function(a){if(!this._selected&&this._isWasSelected){var b;this._prevFocus?(b=this.ui.focus,this.ui.focus=this._prevFocus,this.options.unSelectAll.call(this.$el,a,this.ui),this.ui.focus=b):this.options.unSelectAll.call(this.$el,a,this.ui)}this.ui.items=this._changedItems,this.options.stop.call(this.$el,a,this.ui),this._isPrevented&&this._cancel(a),this._changedItems=[],this._prevItemsState=[],delete this.ui.items,delete this.ui.target,delete this.ui.handle,delete this._items,delete this._isRangeSelect,delete this._isMultiSelect,delete this._isTargetWasSelected,delete this._isWasSelected},a.fn[e]=function(a){if(a&&a.charAt){var b=d.command.apply(this,arguments);return b!==c?b:this}return a&&a.addClass||a.parentNode?d.command.call(this,a):this.each(function(b,c){d.getDataObject(c)||new d(c,a)})}}(jQuery,window);